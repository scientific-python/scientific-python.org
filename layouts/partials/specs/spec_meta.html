{{ $page := . }}
{{ $isSpec := eq (len (findRE "^spec-\\d*" .File.ContentBaseName)) 1 }}
<div class="sd-container-fluid sd-mb-4" >
<div class="sd-row">
<div class="sd-col sd-d-flex-row">
<div class="sd-card sd-w-100 sd-shadow-sm">
<div class="sd-card-body">
    <table class="spec-meta">
    {{ $meta_fields := (slice "author" "discussion" "history" "endorsed-by") }}
    {{- range $attr := $meta_fields -}}
      {{ $val := index $.Params $attr }}
      {{ $attr := strings.TrimPrefix "spec_" $attr }}
      {{- if eq $attr "author" }}
        {{ $attr = "authors" }}
        {{- if not (reflect.IsSlice $val) }}
          {{ $val = slice $val }}
        {{ end }}
      {{- else if eq $attr "date" }}
        {{ $val = $val.Format "2006-01-02" }}
      {{- else if (eq $attr "history") }}
        {{ $path := index (split $page.File "specs/") 1 }}
        {{ $link := printf "https://github.com/scientific-python/specs/commits/main/%s" $path }}
        {{ $val = printf "<a href=\"%s\">%s</a>" $link $link }}
      {{- end -}}
      {{ $isSpecField := (in (slice "endorsed-by" "discussion" ) $attr) }}
      {{ if (or $isSpec (not $isSpecField)) }}
        <tr class="spec-field">
          <td class="spec-field-name">
            {{ $attr | humanize }}:
          </td>
          {{- if (reflect.IsSlice $val) -}}
            {{ $len := len $val }}
            <td class="spec-field-value">
            {{- range $idx, $el := $val }}
              {{ if eq $attr "endorsed-by" }}
                <a href="{{ relref $.Page.CurrentSection (printf "core-projects/%s" $el) }}">{{ $el }}</a>
              {{- else }}
                {{ $el }}
              {{- end -}}
              {{- if not (eq (add $idx 1) $len) -}},{{ end }}
            {{ end }}
            </td>
          {{- else }}
            <td class="spec-field-value">
              {{ $val | markdownify }}
            </td>
          {{- end -}}
        </tr>
      {{- end -}}
    {{/* add warning that this is a draft, i.e. has not been endorsed by 2 projects or more */}}
    {{- if (and (eq $attr "endorsed-by") (lt (len (or $val "")) 2)) -}}
        {{/* add warning */}}
        <div class="admonition attention spec-meta">
          <div class="admonition-title">
            Attention
          </div>
          <p>This is a draft document.</p>
        </div>
    {{- end -}}
    {{- end -}}
    </table>
</div>
</div>
</div>
</div>
</div>
